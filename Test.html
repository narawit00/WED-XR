<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>หัวใจมนุษย์ 3D สมจริง</title>
    <style>
        body { 
            margin: 0; 
            overflow: hidden; 
            background: radial-gradient(circle at 50% 50%, #1a1a2e 0%, #0f0f1e 100%);
            font-family: 'Sarabun', sans-serif;
        }
        #info {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            color: #fff;
            pointer-events: none;
            z-index: 10;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }
        h1 { margin: 0; font-weight: 700; color: #ff6b6b; font-size: 1.8rem;}
        p { margin: 5px; font-size: 1rem; color: #ddd; }
        canvas { display: block; outline: none; }
        #loading {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            color: #ff6b6b; font-size: 1.2rem; font-weight: bold;
            background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px;
        }
        #controls {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            backdrop-filter: blur(10px);
        }
        #controls button {
            display: block;
            width: 100%;
            margin: 5px 0;
            padding: 10px;
            background: #c91e3a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        #controls button:hover {
            background: #ff4757;
            transform: scale(1.05);
        }
        #info-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
            max-width: 80%;
            text-align: center;
            z-index: 1000;
            transition: all 0.3s ease;
            color: white;
            border: 1px solid #ff6b6b;
        }
        #info-panel h2 {
            margin: 0 0 10px 0;
            color: #ff6b6b;
            font-size: 22px;
            font-weight: 600;
        }
        #info-panel p {
            margin: 5px 0;
            color: #eee;
            font-size: 15px;
            line-height: 1.5;
        }
        .marker {
            position: absolute;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #ff6b6b;
            color: white;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translate(-50%, -50%);
            cursor: pointer;
            z-index: 100;
            box-shadow: 0 0 15px rgba(255,107,107,0.8);
            transition: all 0.3s;
            border: 2px solid white;
        }
        .marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
            background: #ff4757;
        }
        .marker.active {
            transform: translate(-50%, -50%) scale(1.3);
            background: #2ed573;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>

    <div id="info">
        <h1>โมเดลหัวใจมนุษย์ 3D สมจริง</h1>
        <p>คลิกที่ตัวเลขเพื่อดูข้อมูลเชิงลึกของแต่ละส่วน</p>
    </div>
    <div id="loading">กำลังสร้างโมเดลหัวใจ...</div>

    <div id="controls">
        <button onclick="resetView()">รีเซ็ตมุมมอง</button>
        <button onclick="toggleRotation()">หยุด/เริ่มหมุนอัตโนมัติ</button>
    </div>

    <div id="info-panel">
        <h2>หัวใจมนุษย์</h2>
        <p>คลิกที่ตัวเลขบนโมเดลเพื่อศึกษาส่วนต่างๆ</p>
        <p style="color: #888; font-size: 12px;">* ลากเมาส์เพื่อหมุนดูรายละเอียด</p>
    </div>

    <!-- Interactive Markers -->
    <div id="marker1" class="marker" style="display: none;">1</div>
    <div id="marker2" class="marker" style="display: none;">2</div>
    <div id="marker3" class="marker" style="display: none;">3</div>
    <div id="marker4" class="marker" style="display: none;">4</div>
    <div id="marker5" class="marker" style="display: none;">5</div>
    <div id="marker6" class="marker" style="display: none;">6</div>
    <div id="marker7" class="marker" style="display: none;">7</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.132.2/examples/js/controls/OrbitControls.js"></script>
    <script>
        // Scene Setup
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0f0f1e);
        scene.fog = new THREE.Fog(0x0f0f1e, 10, 25);
        
        const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 1, 10);
        
        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);
        
        // Lighting System
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
        scene.add(ambientLight);
        
        const mainLight = new THREE.DirectionalLight(0xffffff, 1.0);
        mainLight.position.set(5, 8, 5);
        mainLight.castShadow = true;
        mainLight.shadow.mapSize.width = 2048;
        mainLight.shadow.mapSize.height = 2048;
        scene.add(mainLight);
        
        const rimLight = new THREE.DirectionalLight(0xff6b6b, 0.6);
        rimLight.position.set(-5, -5, -5);
        scene.add(rimLight);
        
        const fillLight = new THREE.PointLight(0xffffff, 0.5);
        fillLight.position.set(0, 0, 8);
        scene.add(fillLight);
        
        // Heart Group
        const heartGroup = new THREE.Group();
        
        // Realistic Heart Material
        const heartMaterial = new THREE.MeshStandardMaterial({
            color: 0xcc2e3e,
            roughness: 0.6,
            metalness: 0.1,
            normalScale: new THREE.Vector2(0.5, 0.5)
        });
        
        // 1. Left Ventricle (Main pumping chamber)
        const leftVentricle = new THREE.Mesh(
            new THREE.SphereGeometry(1.8, 64, 64), 
            heartMaterial
        );
        leftVentricle.scale.set(0.9, 1.2, 0.8);
        leftVentricle.position.set(-0.3, 0, 0);
        
        // 2. Right Ventricle
        const rightVentricle = new THREE.Mesh(
            new THREE.SphereGeometry(1.4, 64, 64), 
            heartMaterial
        );
        rightVentricle.scale.set(0.7, 1.0, 0.7);
        rightVentricle.position.set(0.8, -0.2, 0.3);
        
        // 3. Left Atrium
        const leftAtrium = new THREE.Mesh(
            new THREE.SphereGeometry(0.9, 32, 32), 
            heartMaterial
        );
        leftAtrium.scale.set(0.8, 0.6, 0.9);
        leftAtrium.position.set(-0.5, 2.2, -0.5);
        
        // 4. Right Atrium
        const rightAtrium = new THREE.Mesh(
            new THREE.SphereGeometry(0.85, 32, 32), 
            heartMaterial
        );
        rightAtrium.scale.set(0.8, 0.6, 0.9);
        rightAtrium.position.set(0.6, 2.2, -0.4);
        
        // 5. Right Atrial Appendage
        const appendageGeom = new THREE.SphereGeometry(0.4, 16, 16);
        appendageGeom.scale(1.5, 0.8, 0.6);
        const rightAppendage = new THREE.Mesh(appendageGeom, heartMaterial);
        rightAppendage.position.set(1.2, 2.0, 0.2);
        
        // Combine chambers
        heartGroup.add(leftVentricle, rightVentricle, leftAtrium, rightAtrium, rightAppendage);
        
        // 6. Aorta with Arch
        const aortaCurve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0, 2.8, 0),
            new THREE.Vector3(0, 3.5, 0),
            new THREE.Vector3(0.5, 4.2, -0.5),
            new THREE.Vector3(1.2, 4.5, -1.2)
        ]);
        const aortaGeometry = new THREE.TubeGeometry(aortaCurve, 32, 0.35, 16, false);
        const aorta = new THREE.Mesh(aortaGeometry, heartMaterial);
        heartGroup.add(aorta);
        
        // 7. Pulmonary Artery
        const pulmonaryCurve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0.3, 2.6, -0.2),
            new THREE.Vector3(0.8, 3.2, -0.8),
            new THREE.Vector3(1.5, 3.4, -1.5)
        ]);
        const pulmonaryGeometry = new THREE.TubeGeometry(pulmonaryCurve, 32, 0.3, 16, false);
        const pulmonaryArtery = new THREE.Mesh(pulmonaryGeometry, heartMaterial);
        heartGroup.add(pulmonaryArtery);
        
        // 8. Superior Vena Cava
        const svcGeometry = new THREE.CylinderGeometry(0.22, 0.25, 2.0, 32);
        const svc = new THREE.Mesh(svcGeometry, heartMaterial);
        svc.position.set(-0.7, 2.7, 0.3);
        svc.rotation.z = -0.2;
        heartGroup.add(svc);
        
        // 9. Inferior Vena Cava
        const ivcGeometry = new THREE.CylinderGeometry(0.25, 0.28, 1.8, 32);
        const ivc = new THREE.Mesh(ivcGeometry, heartMaterial);
        ivc.position.set(0, -1.8, 0);
        heartGroup.add(ivc);
        
        // 10. Coronary Arteries (simplified network)
        const coronaryMaterial = new THREE.MeshStandardMaterial({ color: 0xff4444, roughness: 0.8 });
        
        // Left Coronary Artery
        const leftCoronaryCurve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0, 2.0, 0.5),
            new THREE.Vector3(-0.3, 1.5, 1.0),
            new THREE.Vector3(-0.8, 0.5, 1.2),
            new THREE.Vector3(-1.2, -0.5, 0.8)
        ]);
        const leftCoronary = new THREE.Mesh(
            new THREE.TubeGeometry(leftCoronaryCurve, 32, 0.05, 8, false),
            coronaryMaterial
        );
        heartGroup.add(leftCoronary);
        
        // Right Coronary Artery
        const rightCoronaryCurve = new THREE.CatmullRomCurve3([
            new THREE.Vector3(0.3, 1.8, 0.5),
            new THREE.Vector3(1.0, 1.2, 0.8),
            new THREE.Vector3(1.5, 0, 0.5),
            new THREE.Vector3(1.3, -1.0, 0.2)
        ]);
        const rightCoronary = new THREE.Mesh(
            new THREE.TubeGeometry(rightCoronaryCurve, 32, 0.05, 8, false),
            coronaryMaterial
        );
        heartGroup.add(rightCoronary);
        
        scene.add(heartGroup);
        
        // Anatomical Marker Positions
        const markerPositions = {
            '1': { x: 0, y: 3.5, z: -1 },
            '2': { x: 1.2, y: 3.2, z: -1 },
            '3': { x: -0.7, y: 2.7, z: 0.3 },
            '4': { x: 0, y: -1.8, z: 0 },
            '5': { x: -0.8, y: 2, z: 1 },
            '6': { x: -0.3, y: 1.5, z: 1.2 },
            '7': { x: 0.6, y: 2.2, z: -0.8 }
        };
        
        // Anatomical Information in Thai
        const currentInfo = {
            '1': { 
                name: 'Aorta (เอาตา)', 
                desc: 'หลอดเลือดแดงใหญ่ที่สุด ส่งเลือดออกซิเจนไปเลี้ยงทั่วร่างกาย ความดันสูง ผนังหนาแข็งแรง' 
            },
            '2': { 
                name: 'Pulmonary Artery (หลอดเลือดแดงปอด)', 
                desc: 'ส่งเลือดที่มีคาร์บอนไดออกไซด์จากหัวใจไปยังปอดเพื่อแลกเปลี่ยนก๊าซ เป็นเส้นเดียวที่พาเลือดไม่มีออกซิเจนออกจากหัวใจ' 
            },
            '3': { 
                name: 'Superior Vena Cava (หลอดเลือดดำใหญ่ส่วนบน)', 
                desc: 'นำเลือดดำจากศีรษะ ลำคอ และแขนทั้งสองข้างกลับสู่ห้องหัวใจห้องขวาบน (Right Atrium)' 
            },
            '4': { 
                name: 'Inferior Vena Cava (หลอดเลือดดำใหญ่ส่วนล่าง)', 
                desc: 'นำเลือดดำจากลำตัวส่วนล่างและขาทั้งสองข้างกลับสู่หัวใจห้องขวาบน เป็นเส้นเลือดดำที่ใหญ่ที่สุดในร่างกาย' 
            },
            '5': { 
                name: 'Left Ventricle (ห้องล่างซ้าย)', 
                desc: 'ห้องสูบฉีดเลือดหลัก มีความดันสูงสุด ผนังหนาที่สุด (ประมาณ 10-15 มม.) ส่งเลือดไปทั่วร่างกาย' 
            },
            '6': { 
                name: 'Left Coronary Artery (หลอดเลือดแดงหัวใจซ้าย)', 
                desc: 'เลี้ยงกล้ามเนื้อหัวใจส่วนใหญ่ แตกสาขาเป็น LAD และ LCx สำคัญมาก ถ้าตีบจะก่อให้เกิดกล้ามเนื้อตาย' 
            },
            '7': { 
                name: 'Pulmonary Veins (หลอดเลือดดำปอด)', 
                desc: 'นำเลือดที่มีออกซิเจนจากปอด 4 เส้น กลับเข้าห้องหัวใจห้องซ้ายบน (Left Atrium) เพื่อสูบไปเลี้ยงร่างกาย' 
            }
        };
        
        // Update marker positions
        function updateMarkerPositions() {
            for (let i = 1; i <= 7; i++) {
                const pos = markerPositions[i];
                const vector = new THREE.Vector3(pos.x, pos.y, pos.z);
                vector.project(camera);
                
                const x = (vector.x * 0.5 + 0.5) * window.innerWidth;
                const y = (-vector.y * 0.5 + 0.5) * window.innerHeight;
                
                const marker = document.getElementById(`marker${i}`);
                marker.style.display = 'block';
                marker.style.left = x + 'px';
                marker.style.top = y + 'px';
            }
        }
        
        // Marker click handlers
        for (let i = 1; i <= 7; i++) {
            document.getElementById(`marker${i}`).addEventListener('click', function() {
                const info = currentInfo[i];
                const panel = document.querySelector('#info-panel');
                
                panel.innerHTML = `
                    <h2>${info.name}</h2>
                    <p>${info.desc}</p>
                    <p style="color: #999; font-size: 12px; margin-top: 10px;">คลิกส่วนอื่นเพื่อดูข้อมูลเพิ่มเติม</p>
                `;
                
                // Reset all markers
                document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
                this.classList.add('active');
            });
        }
        
        // Controls
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.08;
        controls.minDistance = 5;
        controls.maxDistance = 20;
        
        let time = 0;
        let rotating = true;
        
        // Hide loading
        document.getElementById('loading').style.display = 'none';
        
        // Control functions
        window.toggleRotation = function() {
            rotating = !rotating;
        };
        
        window.resetView = function() {
            camera.position.set(0, 1, 10);
            controls.reset();
            document.querySelectorAll('.marker').forEach(m => m.classList.remove('active'));
        };
        
        // Animation loop
        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;
            
            // Realistic heartbeat
            const beat = Math.sin(time * 3) * 0.5 + 0.5;
            const scale = 1.0 + (beat * 0.03);
            heartGroup.scale.set(scale, scale, scale);
            
            // Subtle movement
            heartGroup.rotation.z = Math.sin(time * 0.5) * 0.01;
            
            // Auto rotation
            if (rotating) {
                heartGroup.rotation.y += 0.003;
            }
            
            controls.update();
            renderer.render(scene, camera);
            updateMarkerPositions();
        }
        
        // Resize handler
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
        
        animate();
    </script>
</body>
</html>